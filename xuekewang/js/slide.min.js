(function(a,b){if(typeof define==="function"&&define.cmd){define(function(d,c,e){var f=d("$");return b(f)})}else{if(typeof define==="function"&&define.amd){define(["$"],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.CarouselImage=b(window.Zepto||window.jQuery||$)}}}})(this,function(b){b.fn.CarouselImage=function(c){var d=[];b(this).each(function(){var e=new a();var f=b.extend({target:b(this)},c);e.init(f);d.push(e)});return d};function a(){}a.prototype={init:function(d){var f=this;this.settings=b.extend({auto:true,resizeImg:true},d);this.index=0;this.container=d.target;this.content=this.container.children().first();this.timer=d.timer||3000;this.animate=d.animate||300;this.num=d.num||null;this.list=this.content.children();this.size=this.list.length;this.repeat=d.repeat||false;this.step=this.container.width();if(this.repeat){var c=this.list.first().clone();var e=this.list.last().clone();this.content.append(c);this.content.prepend(e);this.content.css({left:-this.container.width(),position:"absolute"});this.content.width((this.list.length+2)*this.step)}else{this.content.css({left:0,position:"absolute"});this.content.width(this.list.length*this.step)}this.setHeightWidth();this.bindEvent();this.auto();this.formatNum();this.settings.callback&&this.settings.callback.call(this)},setHeightWidth:function(){var e=this.settings;if(e.width){this.container.width(e.width)}if(e.height){this.container.height(e.height)}this.step=this.container.width();if(e.repeat){this.content.width((this.list.length+2)*this.step)}else{this.content.width(this.list.length*this.step)}for(var d=0,c=this.content.children().length;d<c;d++){var g=b(this.content.children()[d]);g.find("img").addClass("carousel-"+d).attr("data-index",d)}var h=this;this.container.find("a").css({width:this.step,height:this.container.height(),position:"relative"});this.container.find("img").each(function(){var j=new Image();j.src=b(this).attr("src");var k=b(this).data("index");if(h.settings.resizeImg){(function(l,m){if(l.complete){f.call(l,m)}else{l.onreadystatechange=function(){if(this.readystate=="complete"||this.readyState=="loaded"){f.call(this,m)}};l.onload=function(){f.call(this,m)}}})(j,k)}});function f(n){var o=this.height;var r=this.width;var p=h.container;if(!h.settings.height){var j=(h.container.width()/r)*o;h.container.height((h.container.width()/r)*o);h.container.find("a").height(j);h.content.css({position:"absolute"})}var l=h.container.width();var t=l/r*o;if(b(".carousel-"+n,p).height()>h.container.height()){b(".carousel-"+n,p).height(h.container.height());b(".carousel-"+n,p).width(h.container.height()/o*r)}if(b(".carousel-"+n,p).width()>h.container.width()){b(".carousel-"+n,p).width(l);b(".carousel-"+n,p).height(t)}var m=b(".carousel-"+n,p).width();var s=b(".carousel-"+n,p).height();var q=(h.container.height()-s)/2;var k=(h.container.width()-m)/2;b(".carousel-"+n,p).css({left:k,top:q,position:"absolute"})}},touch:function(h,d,e){var c;var g=false;if(typeof d==="function"){e=d}b(h).on("touchmove",d,function(i){c=true;event.preventDefault()}).on("touchend",d,function(i){i.preventDefault();if(!c){var j=e.call(this,i,"touch");if(j===false){i.preventDefault();i.stopPropagation()}}c=false});b(h).on("click",d,f);function f(i){return e.call(this,i)}},bindEvent:function(){var h=this;var g={},f=0,d={},c=false;var e={};this.content.on("touchstart",function(j){var i=(j.changedTouches||j.originalEvent.changedTouches);g={x:i[0].pageX};if(i.length==2){c=false;return false}e=b(this).position();f=g.x;h.stop()}).on("touchmove",function(j){var i=(j.changedTouches||j.originalEvent.changedTouches);if(i.length==2){return false}c=true;d={x:i[0].pageX};if(!h.bloom){e.left=e.left+(d.x-g.x);b(this).css({left:e.left})}else{e={left:e.left+(d.x-g.x)};b(this).css(e)}g=d;return false}).on("touchend",function(k){var i=(k.changedTouches||k.originalEvent.changedTouches);d={x:i[0].pageX};var j=b(this).position();var l={left:j.left+(d.x-g.x)};b(this).css(l);if(d.x>f+10){h.index--;h.go()}else{if(d.x<f-10){h.index++;h.go()}}c=false;h.auto()});h.touch(h.num,"i",function(){clearInterval(h.interval);h.index=b(this).index();h.go();h.auto()});b(window).resize(function(){if(!h.settings.width){h.content.find("img").css({width:"auto",height:"auto"});h.go();h.setHeightWidth()}})},formatNum:function(){if(this.num){var f="";for(var e=0,d=this.list.length;e<d;e++){var g=this.list[e];var c="";if(this.index==e){c="current"}f+='<i class="'+c+'">'+(e+1)+"</i>"}this.num.html(f);this.settings.formatNumCallback&&this.settings.formatNumCallback.call(this)}},go:function(){var e=this;var c=e.step;if(this.repeat){var d=-(e.index+1)*c;if(e.index<0){d=0}if(e.index==0){d=-c}e.content.animate({left:d},e.animate,function(){if(e.index<0){e.index=e.list.size()-1;e.content.css("left",-(e.index+1)*c)}if(e.index>=e.list.size()){e.index=0;e.content.css("left",-1*c)}e.formatNum()})}else{if(e.index<0){e.index=0}if(e.index>=e.size){e.index=e.size-1}var d=-e.index*c;e.content.animate({left:d},e.animate,function(){e.formatNum()})}this.settings.changeCallback&&this.settings.changeCallback.call(this)},auto:function(){if(!this.settings.auto){return}var c=this;if(this.interval){c.stop()}this.interval=setInterval(function(){c.index++;if(!c.repeat){if(c.index>=c.size){c.index=0}}c.go()},this.timer)},stop:function(){clearInterval(this.interval);this.interval=null}};return a});